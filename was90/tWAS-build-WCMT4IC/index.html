



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Building a tWAS container from an existing environment (without scripts) - Application Modernization</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#building-a-twas-container-from-an-existing-environment-without-scripts" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Application Modernization" aria-label="Application Modernization" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Application Modernization
            </span>
            <span class="md-header-nav__topic">
              
                Building a tWAS container from an existing environment (without scripts)
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ibm-cloud-architecture/cloudpak-for-applications
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Application Modernization" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Application Modernization
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ibm-cloud-architecture/cloudpak-for-applications
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../liberty/" title="Runtime modernization" class="md-nav__link">
      Runtime modernization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../spring/" title="Spring modernization" class="md-nav__link">
      Spring modernization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Operational modernization" class="md-nav__link">
      Operational modernization
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-the-websphere-configuration-migration-tool-for-ibm-cloud" class="md-nav__link">
    Introduction to the WebSphere Configuration Migration Tool for IBM Cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-websphere-configuration-migration-tool-for-ibm-cloud" class="md-nav__link">
    Install WebSphere Configuration Migration Tool for IBM Cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-tool-to-generate-artifacts" class="md-nav__link">
    Using the tool to generate artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modify-artifacts" class="md-nav__link">
    Modify artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-image" class="md-nav__link">
    Build the image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-the-image" class="md-nav__link">
    Test the image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-configuration-without-rebuilding-container" class="md-nav__link">
    Modifying Configuration without rebuilding container
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/edit/master/docs/was90/tWAS-build-WCMT4IC.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="building-a-twas-container-from-an-existing-environment-without-scripts">Building a tWAS container from an existing environment (without scripts)</h1>
<p>This section covers how to containerize an existing application running on traditional WebSphere Application Server.  Ideally a user would have scripts to configure their environment and building a container using scripts is descibed <a href="../tWAS-build/">here</a>. However if you don't have scripts and building those scripts is a daunting task, you can migrate your existing configuration using the <a href="https://developer.ibm.com/wasdev/docs/websphere-config-migration-cloud/">WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)</a>.  This tool extracts the configuration from your existing traditional WebSphere Application Server environment and puts it into a tWAS container. </p>
<h2 id="summary">Summary:</h2>
<p>This section has the following steps:</p>
<ul>
<li>Run [WebSphere Configuration Migration Tool for IBM Cloud (WCMT4IC)] to extract the server configuration information from an existing environment.</li>
<li><a href="../tWAS-build/#modifying-configuration-without-rebuilding-container">Using environment variables in properties files to allow configuration to be injected in to the runtime environment dynamically.</a></li>
<li>Running the application in a Docker container locally</li>
</ul>
<h2 id="introduction-to-the-websphere-configuration-migration-tool-for-ibm-cloud">Introduction to the WebSphere Configuration Migration Tool for IBM Cloud</h2>
<p>WCMT4IC is a Java based tool, that provides an easy to use wizard for cloning your WebSphere V7, V8, V855 or V9 environment to the IBM Cloud or to your IBM Cloud Private installation. It allows you to selectively migrate an application deployed in your WebSphere cell into its own WebSphere standalone server, which can run on a virtual machine or in a Docker container ready to be deployed in IBM Cloud Private (ICP).</p>
<p>This article focuses on the steps required to migrate to a Docker container.</p>
<h2 id="install-websphere-configuration-migration-tool-for-ibm-cloud">Install WebSphere Configuration Migration Tool for IBM Cloud</h2>
<p>WCMT4IC is freely available to download from <a href="https://developer.ibm.com/wasdev/downloads/#asset/tools-WebSphere_Configuration_Migration_Tool_for_IBM_Cloud">here</a>. To install the tool extract downloaded file to new directory. As the tool requires Java 8 or higher, make sure Java is available in your PATH environment variable. If not, you can set it like this:</p>
<p>For Windows:</p>
<p><code>set PATH=C:\java\bin;%PATH%</code></p>
<p>where <code>C:\java</code> points to you existing Java installation directory</p>
<p>For Linux/Mac:</p>
<p><code>export PATH=/opt/java8/bin:$PATH</code></p>
<p>where <code>/opt/java8/</code> points to you existing Java installation directory</p>
<p>To start the tool run this command for the installation folder:</p>
<p><code>java -jar CloudMigration.jar</code></p>
<p>The tool can either be installed and run on the machine where WebSphere Application Server is installed or on a remote location. </p>
<h2 id="using-the-tool-to-generate-artifacts">Using the tool to generate artifacts</h2>
<p>After you start the tool, it opens the following window where you can choose either Virtual Machine wizard or Container (Docker) wizard. In this guide you will use the container one.</p>
<ol>
<li>Click <strong>Start Containers Migration Wizard</strong></li>
</ol>
<p><img alt="Wizard" src="../images/tWAS-build/01-wizard.jpg" /></p>
<ol>
<li>The welcome screen is shown, which describes overview of the steps. Click <strong>Next &gt;</strong></li>
</ol>
<p><img alt="Welcome" src="../images/tWAS-build/02-welcome.jpg" /></p>
<ol>
<li>WebSphere cell selection screen is shown. If you are running the tool on the same machine where WebSphere is installed, then the installation folder and list of available cells(profiles) are automatically populated. Select cell and click <strong>Next &gt;</strong>. Alternatively, if installation folder is not populated or WebSphere is not installed locally, click <strong>Locate ...</strong> button to work with remote installation. <strong>If you are running locally, go directly to step 5</strong>.</li>
</ol>
<p><img alt="Select Cell" src="../images/tWAS-build/03-select-cell.jpg" /></p>
<p>4a. (Optional - Remote installation only) Select <strong>Install from an installation on another server</strong> and then click <strong>Save WASPreUpgrade utility</strong>.</p>
<p><img alt="Remote Cell" src="../images/tWAS-build/04-remote-cell.jpg" /></p>
<p>4b. Select directory, specify filename for WASPreUpgrade utility archive and click <strong>Save</strong></p>
<p><img alt="Remote Cell utility" src="../images/tWAS-build/04a-remote-utility.jpg" /></p>
<p>4c. Utility is being saved</p>
<p><img alt="Remote Cell progress" src="../images/tWAS-build/04b-remote-utility-progress.jpg" /></p>
<p>4d. Transfer the generated utility archive to the target server and unzip it. Utility requires <code>JAVA_HOME</code> environment variable. You can set it like this.
For Windows:</p>
<p><code>set JAVA_HOME=C:\WebSphere\AppServer\java</code></p>
<p>where <code>C:\WebSphere\AppServer\java</code> points to you existing Java installation directory</p>
<p>For Linux/Mac:</p>
<p><code>export JAVA_HOME=/opt/WebSphere/AppServer/java</code></p>
<p>where <code>/opt/WebSphere/AppServer/java</code> points to you existing Java installation directory</p>
<p>Run the utility using the following command:</p>
<p><code>WASPre/bin/WASPreUpgrade.sh /home/icpadmin/Documents/backup /opt/IBM/WebSphere/AppServer855/profiles/AppSrv01</code></p>
<p>4e. Zip backup folder using the command:</p>
<p><code>zip -r backup.zip backup</code></p>
<p>4f. Transfer archive to machine with WCMT4IC and unzip it. In the tool click <strong>Browse</strong> button, locate unzipped folder, select it and click <strong>Open</strong></p>
<p><img alt="Remote Cell import" src="../images/tWAS-build/04c-remote-utility-import.jpg" /></p>
<p>4g. Ensure that correct directory is visible and click <strong>Choose Directory</strong></p>
<p><img alt="Remote Cell choose" src="../images/tWAS-build/04d-remote-utility-choose.jpg" /></p>
<p>4h. Your WebSphere cell and profile data are prefilled, select required profile and click <strong>Next</strong></p>
<p><img alt="Remote Cell select" src="../images/tWAS-build/03-select-cell.jpg" /></p>
<ol>
<li>Select application to be migrated and click <strong>Next</strong></li>
</ol>
<p><img alt="Select application" src="../images/tWAS-build/05-select-app.jpg" /></p>
<ol>
<li>Generate container artifacts. The first step is to create the migration backup directory for the node containing the selected application to be migrated. Click <strong>Migrate</strong>.</li>
</ol>
<p><img alt="Migrate" src="../images/tWAS-build/06-migr-backup.jpg" /></p>
<ol>
<li>If WebSphere global security is enabled you will be prompted for the userid and password.</li>
</ol>
<p><img alt="Authenticate" src="../images/tWAS-build/07-migr-backup-pass.jpg" /></p>
<ol>
<li>Second step is to generate the required files to create container image. You may change target directory or accept the default provided. Click <strong>Generate</strong></li>
</ol>
<p><img alt="Generate" src="../images/tWAS-build/08-generate.jpg" /></p>
<ol>
<li>Third step is to examine generated files. You will do it later. Click <strong>Next</strong></li>
</ol>
<p><img alt="Review" src="../images/tWAS-build/09-review.jpg" /></p>
<ol>
<li>Artifacts are successfully generated, now you need to review and customize them according to your needs. Generated artifacts include:</li>
<li>Dockerfile</li>
<li>Migration directory</li>
<li>migration.properties</li>
</ol>
<p><img alt="Complete modify" src="../images/tWAS-build/10-modify.jpg" />.</p>
<h2 id="modify-artifacts">Modify artifacts</h2>
<p>Here is <a href="artifacts/tWAS-build-WCMT/Dockerfile_generated">generated Dockerfile</a>. This is not enough in our case. The migrated application required database drivers, which was defined via WebSphere variable and located in the external directory.</p>
<p><img alt="Driver path" src="../images/tWAS-build/11-driver-path.jpg" /></p>
<p>You have to copy the drivers to the generated directory where Dockerfile is located and modify Dockerfile with information where to put them in the image. Add highlighted line to Dockerfile.</p>
<p><code>COPY --from=migration --chown=was:0 /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/java.security /opt/IBM/WebSphere/AppServer/java/8.0/jre/lib/security/</code>
<strong><code>COPY --chown=was:0 db2drivers/ /opt/IBM/db2drivers/</code></strong>
<code>ENV ADMIN_USER_NAME=wasadmin</code></p>
<p>Here you can find final version of the <a href="artifacts/tWAS-build/Dockerfile">Dockerfile</a>.</p>
<p>What if you would like to modify some settings in the migrated WebSphere?
You can customize your image using property-based configuration mechanism. All available objects are described <a href="https://www.ibm.com/support/knowledgecenter/en/SS7JFU_8.5.5/com.ibm.websphere.express.doc/ae/txml_config_prop.html">Managing specific configuration objects using properties files</a>.
Let's say you would like to change value of this <code>DB2UNIVERSAL_JDBC_DRIVER_PATH</code> variable.</p>
<p>You can create the db2env.props file, with the following contents:</p>
<div class="codehilite"><pre><span></span><code><span class="err">ResourceType=VariableMap</span>
<span class="err">ImplementingResourceType=VariableMap</span>
<span class="err">ResourceId=Cell=!{cellName}:Node=!{nodeName}:Server=!{serverName}:VariableMap=</span>
<span class="err">AttributeInfo=entries(symbolicName,value)</span>
<span class="err">DB2UNIVERSAL_JDBC_DRIVER_PATH=/mydrivers/db2</span>
</code></pre></div>


<p>and add these to the Dockerfile in the following way:</p>
<div class="codehilite"><pre><span></span><code><span class="err">COPY --chown=was:0 db2env.props /work/config/db2env.props</span>
<span class="err">RUN /work/configure.sh</span>
</code></pre></div>


<p>This works for changes to the configuration you want to make at <strong>build</strong> time.  There are other options for configuration changes you would want to make at <strong>deploy</strong> time.  Jump to this section <a href="../tWAS-build/#modifying-configuration-without-rebuilding-container">here</a></p>
<h2 id="build-the-image">Build the image</h2>
<p>See section in <a href="../tWAS-build/#Build-the-image">tWAS-build.md</a></p>
<h2 id="test-the-image">Test the image</h2>
<p>See section in <a href="../tWAS-build/#test-the-image">tWAS-build.md</a></p>
<h2 id="modifying-configuration-without-rebuilding-container">Modifying Configuration without rebuilding container</h2>
<p>See section in <a href="../tWAS-build/#Modifying-configuration-without-rebuilding-container">tWAS-build.md</a></p>
<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, we've taken our estisting traditional WebSphere application.  We've loaded the container with the server and application configuration.  We've installed the application, and modified the configuration if required.  This sets us up for integrating all of this into a CI/CD pipeline and then deploying this to Kubernetes. </p>
<p>We're on our way to the cloud!</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>